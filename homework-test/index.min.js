"use strict";const LOGIN_FUNCTION_URL="https://juvlodhizinsvjaihdeilqgm340rfcqq.lambda-url.us-east-1.on.aws/";class HTTPError extends Error{constructor(status){super(),this.status=status}}function displayLoginStatus(){document.querySelector("#login-status").textContent="Logged in as "+window.localStorage.getItem("name")}function logout(){localStorage.removeItem("token"),sessionStorage.removeItem("completed"),window.location.reload()}async function sendLoginRequest(email,pin){email=await fetch(LOGIN_FUNCTION_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:email,pin:pin})});if(email.ok)return email.json();throw new HTTPError(email.status)}function setValidationError(input,message){message?input.classList.add("is-invalid"):input.classList.remove("is-invalid"),input.parentElement.querySelector(".invalid-feedback").textContent=message}function setServerError(message){var errorField=document.querySelector("#login-email-error");errorField.textContent=message,errorField.style.display="inline"}async function login(){var emailInput=document.querySelector("#login-email"),pinInput=document.querySelector("#login-pin");if(setValidationError(emailInput,""),setValidationError(pinInput,""),!emailInput.checkValidity())return setValidationError(emailInput,emailInput.validationMessage),!1;if(!pinInput.checkValidity())return setValidationError(pinInput,pinInput.validationMessage),!1;var spinner=document.querySelector("#login-spinner");spinner.hidden=!1;let data;try{data=await sendLoginRequest(emailInput.value,pinInput.value)}catch(err){return err instanceof HTTPError&&401===err.status?setValidationError(pinInput,"Incorrect PIN."):err instanceof HTTPError&&403===err.status?setServerError("Unfortunately your access to the site has expired."):err instanceof HTTPError&&404===err.status?setValidationError(emailInput,"Unknown email address.",!0):setServerError("An unexpected error occurred on the server."),!1}finally{spinner.hidden=!0}return localStorage.setItem("token",data.token),localStorage.setItem("name",data.name),document.querySelector("#login-form").reset(),displayLoginStatus(),!0}window.addEventListener("DOMContentLoaded",()=>{document.querySelector("main").hidden=!1;const loginModal=new bootstrap.Modal(document.querySelector("#login-modal"));localStorage.getItem("token")?displayLoginStatus():loginModal.show(),document.querySelector("#login-form").addEventListener("submit",async event=>{event.preventDefault(),await login()&&loginModal.hide()})});